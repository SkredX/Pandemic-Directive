<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pandemic Directive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <div id="terminal" class="terminal"></div>

    <div class="input-row">
      <input
        id="choiceInput"
        type="number"
        placeholder="Enter choice number..."
        min="1"
        disabled
      />
      <button id="submitBtn" disabled>EXECUTE</button>
      <button id="restartBtn" style="display:none;">RESTART</button>
    </div>

    <footer>
      <p>All decisions are irreversible.</p>
    </footer>
  </div>

  <!-- GAME CORE -->
  <script src="game_core.js"></script>

  <!-- UI LOGIC -->
  <script>
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("choiceInput");
    const submitBtn = document.getElementById("submitBtn");
    const restartBtn = document.getElementById("restartBtn");

    let awaitingChoice = false;
    let gameEnded = false;

    function print(text) {
      terminal.textContent += text + "\n";
      terminal.scrollTop = terminal.scrollHeight;
    }

    function start() {
      terminal.textContent = "";
      gameEnded = false;
      awaitingChoice = false;

      // Reset global state (reload page-safe)
      location.reload();
    }

    function processTurn(choice = null) {
      const result = advanceDay(choice);

      print(result.text);

      if (result.ended) {
        gameEnded = true;
        input.disabled = true;
        submitBtn.disabled = true;
        restartBtn.style.display = "inline-block";
        return;
      }

      if (result.choices > 0) {
        awaitingChoice = true;
        input.disabled = false;
        submitBtn.disabled = false;
        input.focus();
      } else {
        awaitingChoice = false;
        input.disabled = true;
        submitBtn.disabled = true;

        // Auto-advance on days with no choices
        setTimeout(() => processTurn(), 600);
      }
    }

    submitBtn.addEventListener("click", () => {
      if (!awaitingChoice || gameEnded) return;

      const val = parseInt(input.value, 10);
      if (isNaN(val) || val < 1) {
        print("\n[INVALID INPUT]");
        return;
      }

      input.value = "";
      input.disabled = true;
      submitBtn.disabled = true;
      awaitingChoice = false;

      processTurn(val - 1);
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") submitBtn.click();
    });

    restartBtn.addEventListener("click", start);

    // BOOT
    processTurn();
  </script>
</body>
</html>
