<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pandemic Directive: Zero Hour</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div id="game-container" class="container">
    <div id="terminal" class="terminal"></div>

    <div class="input-row">
      <input
        id="choiceInput"
        type="number"
        placeholder=">> COMMAND"
        min="1"
        disabled
      />
      <button id="submitBtn" disabled>EXECUTE</button>
      <button id="restartBtn" style="display:none;">SYSTEM REBOOT</button>
    </div>

    <footer>
      <p>Decisions are final. History is watching.</p>
    </footer>
  </div>

  <script src="game_core.js"></script>

  <script>
    // UI LINKING LOGIC
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("choiceInput");
    const submitBtn = document.getElementById("submitBtn");
    const restartBtn = document.getElementById("restartBtn");
    const container = document.getElementById("game-container");

    let awaitingChoice = false;
    let gameEnded = false;

    function print(text) {
      terminal.textContent += text + "\n";
      terminal.scrollTop = terminal.scrollHeight;
    }

    function updateVisualState(isCritical) {
      if (isCritical) {
        container.classList.add("critical");
      } else {
        container.classList.remove("critical");
      }
    }

    function start() {
      // Reload is effective for clearing state in this simple architecture
      location.reload();
    }

    function processTurn(choice = null) {
      // Pass choice to core
      const result = advanceDay(choice);

      // 1. Handle Visuals (Red Text)
      updateVisualState(result.critical);

      // 2. Print Output
      print(result.text);

      // 3. Handle Game End
      if (result.ended) {
        gameEnded = true;
        input.disabled = true;
        submitBtn.disabled = true;
        restartBtn.style.display = "inline-block";
        return;
      }

      // 4. Setup Input for Next Turn
      if (result.choices > 0) {
        awaitingChoice = true;
        input.disabled = false;
        submitBtn.disabled = false;
        input.focus();
      } else {
        // Fallback if we run out of content (shouldn't happen with 25 days)
        print("Signal lost...");
      }
    }

    submitBtn.addEventListener("click", () => {
      if (!awaitingChoice || gameEnded) return;

      const val = parseInt(input.value, 10);
      if (isNaN(val) || val < 1) {
        print("\n[ERROR: INVALID PARAMETER]");
        return;
      }

      input.value = "";
      input.disabled = true;
      submitBtn.disabled = true;
      awaitingChoice = false;

      // Subtract 1 because array index is 0-based, user types 1-based
      processTurn(val - 1);
    });

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") submitBtn.click();
    });

    restartBtn.addEventListener("click", start);

    // Initial Boot
    processTurn();
  </script>
</body>
</html>
